// Serializable/Materializable base class autogenerated by CrackClassGenerator
// 2013-09-20 14:29:41 DST

import crack.lang InvalidArgumentError, Buffer;
import crack.ascii radix;
import crack.cont.array Array;
import crack.io FStr;
import crack.runtime INT_SIZE;
import whip.serializer Serializer, Materializer, Serializable;
import crack.db.mongo_support OID;
FStr sfmt = {};

//------------------------------------------------------------------------------
class testSerialize : Serializable {
  uint32 __id = 0x33a98818;
  uint32 getId() { return __id; }
  int int1 = -1;
  uint uint2 = 1;
  int32 int3 = 2;
  uint32 uint4 = 3;
  String S = "Hello";
  Array[int] A = [10];
  oper init() { }


  void serialize(Serializer __sr, Buffer __name) {
    uint i = 0;
    __sr.prefix(__name);
    __sr.format(__id, "__whipMessageId");
    __sr.format(int1, "int1");
    __sr.format(uint2, "uint2");
    __sr.format(int3, "int3");
    __sr.format(uint4, "uint4");
    __sr.format(S, "S");
    __sr.format(A, "A");
    __sr.postfix(__name);
  }

  void serialize(Serializer __sr) {
    serialize(__sr, null);
  }

  uint sizeNeeded() {
    uint cnt = 4;  // The 32bit id is always there
    cnt += INT_SIZE; // int1
    cnt += INT_SIZE; // uint2
    cnt += 4; // int3
    cnt += 4; // uint4
    cnt += S.size + (4 - (S.size)%4); // S
    cnt += A.count() + (4 - (A.count())%4); // A
    return cnt;
  }

  void materialize(Materializer __mt, Buffer __name) {
    uint32 __in; // an input uint32
    __in = __mt.format(__in, "__whipMessageId"); // Always read the id
    if (__in != __id)
      throw InvalidArgumentError(sfmt `Invalid message signature 0x$(radix(__in, 16)), expected 0x$(radix(__id, 16))`);
    int1 = __mt.format(int1, "int1");
    uint2 = __mt.format(uint2, "uint2");
    int3 = __mt.format(int3, "int3");
    uint4 = __mt.format(uint4, "uint4");
    S = __mt.format(S, "S");
    A = __mt.format(A, "A");
  }

  void materialize(Materializer __mt) {
    materialize(__mt, null);
  }

  oper init(Materializer __mt, Buffer __name) {
     materialize(__mt, __name);
  }

  oper init(Materializer __mt) {
     materialize(__mt, null);
  }
}

//------------------------------------------------------------------------------
class testSerializeContainer : Serializable {
  uint32 __id = 0x6f42935f;
  uint32 getId() { return __id; }
  testSerialize T;
  oper init() { }


  void serialize(Serializer __sr, Buffer __name) {
    uint i = 0;
    __sr.prefix(__name);
    __sr.format(__id, "__whipMessageId");
    T.serialize(__sr, "T");
    __sr.postfix(__name);
  }

  void serialize(Serializer __sr) {
    serialize(__sr, null);
  }

  uint sizeNeeded() {
    uint cnt = 4;  // The 32bit id is always there
    cnt += T.sizeNeeded(); // T
    return cnt;
  }

  void materialize(Materializer __mt, Buffer __name) {
    uint32 __in; // an input uint32
    __in = __mt.format(__in, "__whipMessageId"); // Always read the id
    if (__in != __id)
      throw InvalidArgumentError(sfmt `Invalid message signature 0x$(radix(__in, 16)), expected 0x$(radix(__id, 16))`);
    T.materialize(__mt, "T");
  }

  void materialize(Materializer __mt) {
    materialize(__mt, null);
  }

  oper init(Materializer __mt, Buffer __name) {
     materialize(__mt, __name);
  }

  oper init(Materializer __mt) {
     materialize(__mt, null);
  }
}

